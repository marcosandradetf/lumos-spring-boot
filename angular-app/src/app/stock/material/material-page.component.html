<div class="h-full w-full p-4">

  <!-- Breadcrumb -->
  <app-prime-breadcrumb title="" [path]="['Estoque', 'Materiais']"></app-prime-breadcrumb>

  <!-- Título e botão de cadastro -->
  <div class="flex justify-between items-center my-4">
    <h2 class="text-2xl font-semibold text-gray-800 dark:text-neutral-200">
      Catálogo de Materiais
    </h2>
    <button
      pButton
      type="button"
      label="Cadastrar Material"
      icon="pi pi-plus"
      class="p-button-primary"
      (click)="navigateToCadastro()">
    </button>
  </div>

  <!-- Filtros -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
    <input
      pInputText
      placeholder="Pesquisar por nome"
      [(ngModel)]="filters.materialName"
      (ngModelChange)="applyFilters()"
      class="w-full"
    />
    <p-dropdown
      [options]="materialTypes"
      optionLabel="typeName"
      optionValue="typeId"
      placeholder="Filtrar por tipo"
      [(ngModel)]="filters.materialType"
      (onChange)="applyFilters()"
      class="w-full"
    ></p-dropdown>
    <input
      pInputText
      placeholder="Pesquisar por código de barras"
      [(ngModel)]="filters.barcode"
      (ngModelChange)="applyFilters()"
      class="w-full"
    />
    <button
      pButton
      label="Limpar filtros"
      icon="pi pi-filter-slash"
      class="w-full"
      (click)="clearFilters()"
    ></button>
  </div>

  <!-- Desktop Table -->
  <p-table [value]="filteredMaterials" [loading]="loading" [paginator]="true" [rows]="10" responsiveLayout="scroll">
    <ng-template pTemplate="header">
      <tr>
        <th>Código de Barras</th>
        <th>Nome</th>
        <th>Unidade Compra</th>
        <th>Unidade Requisição</th>
        <th>Status</th>
        <th>Ações</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-material>
      <tr>
        <td>{{ material.barcode }}</td>
        <td>{{ material.materialName }}</td>
        <td>{{ material.buyUnit }}</td>
        <td>{{ material.requestUnit }}</td>
        <td>
          <span [ngClass]="{'text-green-600': !material.inactive, 'text-red-600': material.inactive}">
            {{ material.inactive ? 'Inativo' : 'Ativo' }}
          </span>
        </td>
        <td class="flex gap-2">
          <button pButton type="button" icon="pi pi-pencil" class="p-button-text p-button-sm"
                  (click)="editMaterial(material)"></button>
          <button pButton type="button" icon="pi pi-trash" class="p-button-text p-button-sm p-button-danger"
                  (click)="deleteMaterial(material)"></button>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="19" class="text-center text-gray-500">Nenhum material encontrado.</td>
      </tr>
    </ng-template>
  </p-table>

  <!-- Mobile Cards -->
  <div class="grid grid-cols-1 gap-4 md:hidden">
    <div *ngFor="let material of filteredMaterials"
         class="border rounded-lg p-4 shadow-sm bg-white dark:bg-neutral-800">
      <div class="flex justify-between items-start">
        <div>
          <p class="text-sm font-semibold text-gray-700 dark:text-neutral-200">Código: {{ material.barcode }}</p>
          <p class="text-base font-medium text-gray-800 dark:text-neutral-100">Nome: {{ material.materialName }}</p>
          <p class="text-sm text-gray-600 dark:text-neutral-300">Unidade Compra: {{ material.buyUnit }}</p>
          <p class="text-sm text-gray-600 dark:text-neutral-300">Unidade Requisição: {{ material.requestUnit }}</p>
          <p class="text-sm text-gray-600 dark:text-neutral-300">Status:
            <span [ngClass]="{'text-green-600': !material.inactive, 'text-red-600': material.inactive}">
            {{ material.inactive ? 'Inativo' : 'Ativo' }}
          </span>
          </p>
        </div>
        <div class="flex flex-col gap-2">
          <button pButton type="button" icon="pi pi-pencil" class="p-button-sm p-button-text"
                  (click)="editMaterial(material)"></button>
          <button pButton type="button" icon="pi pi-trash" class="p-button-sm p-button-text text-red-600"
                  (click)="deleteMaterial(material)"></button>
        </div>
      </div>
    </div>
  </div>

  <app-loading-overlay [loading]="loading"></app-loading-overlay>
  <p-toast></p-toast>
</div>
