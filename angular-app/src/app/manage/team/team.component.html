<div class="flex mt-[4rem] h-fit pl-2" #top>
  <div class="w-[85vw] xl:w-[80rem] 2xl:w-[100rem] mb-5 ">
    <div class="breadcrumbs text-sm py-5">
      <ul class="select-none">
        <li><a>Início</a></li>
        <li><a>Configurações</a></li>
        <li>Usuários</li>
      </ul>
    </div>


    <div role="tablist" class="tabs tabs-bordered w-full justify-center mb-5">
      <input type="radio" class="tab" aria-label="Usuários" (click)="router.navigate(['/configuracoes/usuarios'])"/>
      <input type="radio" class="tab" aria-label="Equipes" checked/>
      <input type="radio" class="tab" aria-label="Empresa" disabled
             (click)="router.navigate(['/configuracoes/empresa'])"/>
    </div>

    <form #teamForm="ngForm" (ngSubmit)="submitTeams(teamForm)" class="shadow border p-2">
      <div class="flex justify-evenly pb-5 items-center">
        @if (!add && !change) {
          <app-button title="Alterar Equipes" (click)="change = true">
          </app-button>
        }
        @if (!add && !change) {
          <app-button title="Adicionar Equipes" classButton="btn btn-success text-white" (click)="add = true">
          </app-button>
        }
        @if (add || change) {
          <app-button title="Cancelar" classButton="btn" [action]="resetView()">
          </app-button>
          <app-button title="Salvar" typeButton="submit" [loading]="loading"
                      classButton="btn btn-primary w-32 text-white">
          </app-button>
          @if (add) {
            <div class="flex">
              <div class="flex flex-col items-center mr-2">
                <button class="btn btn-outline btn-primary btn-xs" (click)="newTeam()" type="button">+</button>
                <p class="text-xs">Adicionar</p>
              </div>
              <div class="flex flex-col items-center">
                <button class="btn btn-outline btn-xs" (click)="removeTeam()" type="button">-</button>
                <p class="text-xs">Remover</p>
              </div>
            </div>
          }
        }

      </div>
      <app-table class="min-h-96">
        <tr header>
          <th *ngIf="change"></th>
          <th hidden>Código</th>
          <th>Nome</th>
          <th>Usuário Responsável</th>
          <th>Estado</th>
          <th>Cidade</th>
          <th>Região</th>
        </tr>

        <tr *ngFor="let team of teams; let i = index" class="odd:bg-neutral-100" body>
          @if (change) {
            <td>
              <input type="checkbox"
                     class="check-box"
                     [(ngModel)]="team.sel"
                     (change)="team.sel ? getCities(team.UFName) : null"
                     name="sel{{i}}">
            </td>
            <td hidden>
              <input disabled
                     [(ngModel)]="team.idTeam"
                     name="idTeam{{i}}"
                     type="text"
                     class="input input-bordered input-xs"
              ></td>
            <td>
              <input required
                     [disabled]="!team.sel"
                     [(ngModel)]="team.teamName"
                     name="teamName{{i}}"
                     type="text"
                     placeholder="Insira o nome da equipe"
                     class="input input-bordered input-xs"
                     #teamName="ngModel"
              >
              <div *ngIf="teamName.invalid && (teamName.touched || teamForm.submitted)">
                <small *ngIf="teamName.errors?.['required']" class="text-red-600">Campo obrigatório.</small>
              </div>
            </td>
            <td>
              <p *ngIf="!team.sel" class="input input-bordered input-xs input-disabled">{{ team.username }}</p>
              <div *ngIf="team.sel">
                <select
                  class="select select-bordered select-xs"
                  [(ngModel)]="team.userId"
                  [disabled]="!team.sel"
                  name="userId{{i}}"
                  required
                  #userId="ngModel">
                  <option value="" disabled>Selecione o usuário</option>
                  @for (user of users; track user.userId) {
                    <option [value]="user.userId" [selected]="user.userId === team.userId">{{ user.username }}</option>
                  }
                </select>
                <div *ngIf="userId.invalid && (userId.touched || teamForm.submitted)">
                  <small *ngIf="userId.errors?.['required']" class="text-red-600">Campo obrigatório.</small>
                </div>
              </div>
            </td>
            <td>
              <p *ngIf="!team.sel" class="input input-bordered input-xs input-disabled">{{ team.UFName }}</p>
              <div *ngIf="team.sel">
                <select
                  class="select select-bordered select-xs"
                  [(ngModel)]="team.UFName"
                  [disabled]="!team.sel"
                  name="UFName{{i}}"
                  required
                  #UFName="ngModel">
                  <option value="" disabled>Selecione o estado da equipe</option>
                  @for (uf of ufs; track uf.nome) {
                    <option [value]="uf.sigla">{{ uf.nome }}</option>
                  }
                </select>
                <div *ngIf="UFName.invalid && (UFName.touched || teamForm.submitted)">
                  <small *ngIf="UFName.errors?.['required']" class="text-red-600">Campo obrigatório.</small>
                </div>
              </div>
            </td>
            <td>
              <p *ngIf="!team.sel" class="input input-bordered input-xs input-disabled">{{ team.cityName }}</p>
              <div
                *ngIf="team.sel"
                [ngClass]="{'tooltip': !team.UFName, 'tooltip-bottom': !team.UFName}"
                [attr.data-tip]="team.UFName ? '' : 'Selecione o Estado Primeiro'"
                class="tooltip tooltip-bottom form-control w-full max-w-xs">
                <select
                  (click)="getCities(team.UFName)"
                  (change)="updateRegion($any($event.target).value,i)"
                  [(ngModel)]="team.cityName"
                  class="select select-xs select-bordered"
                  name="cityName{{i}}"
                  [disabled]="!team.UFName"
                  #cityName="ngModel"
                  required>
                  <option value="" disabled>Selecione a cidade da equipe</option>
                  @for (city of cities; track city.nome) {
                    <option [value]="city.nome">{{ city.nome }}</option>
                  }
                </select>
                <div *ngIf="cityName.invalid && (cityName.touched || teamForm.submitted)">
                  <small *ngIf="cityName.errors?.['required']" class="text-red-600">Campo obrigatório.</small>
                </div>
              </div>
            </td>
            <td>
              <div
                [ngClass]="{'tooltip': !team.cityName, 'tooltip-bottom': !team.cityName}"
                [attr.data-tip]="team.cityName ? '' : 'Selecione a Cidade'"
                class="tooltip tooltip-bottom form-control w-full max-w-xs">
                <p class="input input-xs input-disabled">{{ team.regionName }}</p>
              </div>
            </td>

          } @else if (add) {
            <td hidden>
              <input disabled
                     [(ngModel)]="team.idTeam"
                     name="idTeam{{i}}"
                     type="text"
                     class="input input-bordered input-xs"
              ></td>
            <td>
              <input required
                     [disabled]="team.idTeam !== ''"
                     [(ngModel)]="team.teamName"
                     name="teamName{{i}}"
                     type="text"
                     placeholder="Insira o nome da equipe"
                     class="input input-bordered input-xs"
                     #teamName="ngModel"
              >
              <div *ngIf="teamName.invalid && (teamName.touched || teamForm.submitted)">
                <small *ngIf="teamName.errors?.['required']" class="text-red-600">Campo obrigatório.</small>
              </div>
            </td>
            <td>
              <p *ngIf="team.idTeam" class="input input-bordered input-xs input-disabled">{{ team.username }}</p>
              <div *ngIf="!team.idTeam">
                <select
                  class="select select-bordered select-xs"
                  [(ngModel)]="team.userId"
                  [disabled]="team.idTeam !== ''"
                  name="userId{{i}}"
                  required
                  #userId="ngModel">
                  <option value="" disabled>{{ team.username ? team.username : 'Selecione o usuário' }}</option>
                  @for (user of users; track user.userId) {
                    <option [value]="user.userId">{{ user.username }}</option>
                  }
                </select>
                <div *ngIf="userId.invalid && (userId.touched || teamForm.submitted)">
                  <small *ngIf="userId.errors?.['required']" class="text-red-600">Campo obrigatório.</small>
                </div>
              </div>
            </td>
            <td>
              <p *ngIf="team.idTeam" class="input input-bordered input-xs input-disabled">{{ team.UFName }}</p>
              <div *ngIf="!team.idTeam">
                <select
                  class="select select-bordered select-xs"
                  [(ngModel)]="team.UFName"
                  name="UFName{{i}}"
                  [disabled]="team.idTeam !== ''"
                  required
                  #UFName="ngModel">
                  <option value="" disabled>{{ team.UFName ? team.UFName : 'Selecione o estado da equipe' }}</option>
                  @for (uf of ufs; track uf.nome) {
                    <option [value]="uf.sigla">{{ uf.nome }}</option>
                  }
                </select>
                <div *ngIf="UFName.invalid && (UFName.touched || teamForm.submitted)">
                  <small *ngIf="UFName.errors?.['required']" class="text-red-600">Campo obrigatório.</small>
                </div>
              </div>
            </td>
            <td>
              <p *ngIf="team.idTeam" class="input input-bordered input-xs input-disabled">{{ team.cityName }}</p>
              <div
                *ngIf="!team.idTeam"
                [ngClass]="{'tooltip': !team.UFName, 'tooltip-bottom': !team.UFName}"
                [attr.data-tip]="team.UFName ? '' : 'Selecione o Estado Primeiro'"
                class="tooltip tooltip-bottom form-control w-full max-w-xs">
                <select
                  (change)="updateRegion($any($event.target).value, i)"
                  (click)="getCities(team.UFName)"
                  [(ngModel)]="team.cityName"
                  class="select select-xs select-bordered"
                  name="cityName{{i}}"
                  [disabled]="!team.UFName"
                  #cityName="ngModel"
                  required>
                  <option value="" disabled>{{ team.cityName ? team.cityName : 'Selecione a cidade da equipe' }}
                  </option>
                  @for (city of cities; track city.nome) {
                    <option [value]="city.nome">{{ city.nome }}</option>
                  }
                </select>
                <div *ngIf="cityName.invalid && (cityName.touched || teamForm.submitted)">
                  <small *ngIf="cityName.errors?.['required']" class="text-red-600">Campo obrigatório.</small>
                </div>
              </div>
            </td>
            <td>
              <div
                [ngClass]="{'tooltip': !team.cityName, 'tooltip-bottom': !team.cityName}"
                [attr.data-tip]="team.cityName ? '' : 'Selecione a Cidade'"
                class="tooltip tooltip-bottom form-control w-full max-w-xs">
                <p class="input input-xs input-disabled">{{ team.regionName }}</p>
              </div>
            </td>
          } @else {
            <td hidden disabled>{{ team.idTeam }}</td>
            <td>{{ team.teamName }}</td>
            <td>{{ team.username }}</td>
            <td>{{ team.UFName }}</td>
            <td>{{ team.cityName }}</td>
            <td>{{ team.regionName }}</td>
          }
        </tr>
      </app-table>
    </form>
    <app-alert-message [message]="serverMessage" [timeout]=5000 [alertType]="alertType"></app-alert-message>
  </div>
</div>
