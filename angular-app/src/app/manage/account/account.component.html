<div class="flex flex-col w-full max-w-5xl mx-auto px-6 py-6 gap-8">
  <div class="flex items-center gap-4 border-b border-neutral-200 dark:border-neutral-800 pb-6">
    <div
      class="w-14 h-14 rounded-full bg-neutral-200 dark:bg-neutral-700 flex items-center justify-center text-xl font-bold">
      {{ user.username.charAt(0).toUpperCase() }}
    </div>

    <div class="flex flex-col min-w-0">
      <h2 class="font-semibold text-lg truncate">{{ user.username }}</h2>
      <p class="text-sm text-neutral-500 truncate">{{ user.email }}</p>
    </div>
  </div>

  <section class="flex flex-col gap-4">
    <div>
      <h3 class="font-semibold text-base">Conta</h3>
      <p class="text-sm text-neutral-500">
        Informações básicas do seu perfil.
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

      <div
        class="rounded-lg border border-neutral-200 dark:border-neutral-800 p-4 hover:bg-neutral-50 dark:hover:bg-neutral-900 transition">
        <div class="flex items-center justify-between mb-1">
          <span class="font-medium">Nome</span>
          <span class="material-icons text-neutral-400 text-base">person</span>
        </div>
        <p class="text-sm text-neutral-600 dark:text-neutral-400">
          {{ user.name }} {{ user.lastname }}
        </p>
      </div>


      <div class="rounded-lg border border-neutral-200 dark:border-neutral-800 p-4">
        <div class="flex items-center justify-between mb-2">
          <span class="font-medium">Funções no Sistema</span>
          <span class="material-icons text-neutral-400 text-base">psychology</span>
        </div>

        <div class="flex flex-wrap gap-2 select-none">
          <p-chip
            *ngFor="let role of user.role"
            [label]="role"
            class="text-xs">
          </p-chip>
        </div>

      </div>
    </div>
  </section>
  <section class="flex flex-col gap-4">
    <div>
      <h3 class="font-semibold text-base">Segurança</h3>
      <p class="text-sm text-neutral-500">
        Gerencie credenciais e informações sensíveis.
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

      <div class="rounded-lg border border-neutral-200 dark:border-neutral-800 p-4">
        <div class="flex items-center justify-between mb-1">
          <span class="font-medium">Aniversário</span>
          <span class="material-icons text-neutral-400 text-base">cake</span>
        </div>
        <p class="text-sm text-neutral-600 dark:text-neutral-400">
          {{ user.day }} de {{ getMonth(user.month.toString())?.name }} de {{ user.year }}
        </p>
      </div>
      <button
        (click)="user.userId !== '' ? openConfirmationModal = true : (serverMessage = 'Usuário não encontrado')"
        class="flex items-center justify-between rounded-lg border border-red-300 dark:border-red-700 p-4 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 transition">

        <span class="font-medium">Alterar senha</span>
        <span class="material-icons text-base">security</span>
      </button>
    </div>
  </section>

  <p-dialog
    header="Alterar senha"
    [(visible)]="openConfirmationModal"
    [modal]="true"
    [closable]="false"
    [style]="{ width: '420px' }"
    styleClass="rounded-lg">

    <form #passForm="ngForm" (ngSubmit)="submitUser(passForm)" class="flex flex-col gap-4">

      <!-- Senha atual -->
      <div class="flex flex-col gap-1">
        <label class="text-sm font-medium">Senha atual</label>

        <p-password
          name="oldPassword"
          [(ngModel)]="password.oldPassword"
          [feedback]="false"
          [toggleMask]="true"
          required
          placeholder="Digite sua senha atual"
          inputStyleClass="w-full">
        </p-password>

        <small *ngIf="passForm.submitted && !password.oldPassword"
               class="text-red-500">
          Campo obrigatório
        </small>
      </div>

      <!-- Nova senha -->
      <div class="flex flex-col gap-1">
        <label class="text-sm font-medium">Nova senha</label>

        <p-password
          name="password"
          [(ngModel)]="password.password"
          [toggleMask]="true"
          [feedback]="true"
          required
          minlength="8"
          placeholder="Digite sua nova senha"
          inputStyleClass="w-full">
        </p-password>

        <small *ngIf="passForm.submitted && (password.password?.length ?? 0) < 8"
               class="text-orange-500">
          Mínimo de 8 caracteres
        </small>
      </div>

      <!-- Confirmar senha -->
      <div class="flex flex-col gap-1">
        <label class="text-sm font-medium">Confirmar nova senha</label>

        <p-password
          name="passwordConfirm"
          [(ngModel)]="password.passwordConfirm"
          [toggleMask]="true"
          [feedback]="false"
          required
          placeholder="Confirme sua nova senha"
          inputStyleClass="w-full">
        </p-password>

        <small *ngIf="passForm.submitted && password.passwordConfirm !== password.password"
               class="text-red-500">
          As senhas não coincidem
        </small>
      </div>

      <!-- Erro backend -->
      <p-message
        *ngIf="errorPassword"
        severity="error"
        [text]="errorPassword">
      </p-message>

      <p-divider></p-divider>

      <!-- Ações -->
      <div class="flex justify-end gap-2">
        <p-button
          label="Cancelar"
          severity="secondary"
          [outlined]="true"
          type="button"
          (onClick)="openConfirmationModal = false; loading = false">
        </p-button>

        <p-button
          label="Confirmar"
          type="submit"
          [loading]="loading"
          severity="primary">
        </p-button>
      </div>

    </form>

  </p-dialog>


</div>
