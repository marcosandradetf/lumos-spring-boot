<div class="flex mt-[4rem] h-fit" #top>
  <app-sidebar title="Estoque" [links]="sidebarLinks"></app-sidebar>
  <div class="ml-12 lg:ml-14 2xl:ml-[19rem] w-[85vw] xl:w-[80rem] 2xl:w-[100rem] mb-5 ">
    <div class="breadcrumbs text-sm py-5">
      <ul class="select-none">
        <li><a>Início</a></li>
        <li><a>Configurações</a></li>
        <li>Usuários</li>
      </ul>
    </div>

    <div role="tablist" class="tabs tabs-bordered w-full justify-center mb-5">
      <input type="radio" class="tab" aria-label="Usuários" checked/>
      <input type="radio" class="tab" aria-label="Equipes" (click)="router.navigate(['/configuracoes/equipes'])"/>
      <input type="radio" class="tab" aria-label="Minha Empresa" (click)="router.navigate(['/configuracoes/empresa'])"/>
    </div>

    <div class="shadow border p-2">
      <div class="flex justify-evenly pb-5 items-center">
        @if (!add && !change) {
          <app-button title="Alterar Usuários" [action]="changeUser()">

          </app-button>
        }
        @if (!add && !change) {
          <app-button title="Adicionar Usuários" class="btn-success text-white" [action]="addUser()">

          </app-button>
        }
        @if (add || change) {
          <app-button title="Cancelar" class="btn" [action]="cancel()">
          </app-button>
          <app-button title="Salvar"></app-button>
          @if (add) {
            <div class="flex">
              <div class="flex flex-col items-center mr-2">
                <button class="btn btn-outline btn-primary btn-xs" (click)="newUser()">+</button>
                <p class="text-xs">Adicionar</p>
              </div>
              <div class="flex flex-col items-center">
                <button class="btn btn-outline btn-xs" (click)="removeUser()">-</button>
                <p class="text-xs">Remover</p>
              </div>
            </div>
          } @else if (change) {

          }
        }

      </div>
      <form #usersForm="ngForm" (ngSubmit)="submitUsers(usersForm)">
        <app-table>
          <tr header>
            <th hidden>Código</th>
            <th>Usuário</th>
            <th>Nome</th>
            <th>Sobrenome</th>
            <th>Email</th>
            <th>Data de Nascimento</th>
            <th>Funções</th>
            <th>Status</th>
            @if (!add && !change) {
              <th>Ação</th>
            }
          </tr>

          <tr *ngFor="let user of users; let i = index" class="odd:bg-neutral-100" body>
            @if (change) {
              <td hidden><input disabled
                                [(ngModel)]="user.userId"
                                name="userId{{i}}"
                                type="text"
                                class="input input-bordered input-xs"
              ></td>
              <td><input required
                         [(ngModel)]="user.username"
                         name="username{{i}}"
                         type="text"
                         placeholder="Digite aqui"
                         class="input input-bordered input-xs"
              ></td>
              <td><input required
                         [(ngModel)]="user.name"
                         name="name{{i}}"
                         type="text"
                         placeholder="Digite aqui"
                         class="input input-bordered input-xs"></td>
              <td><input required
                         [(ngModel)]="user.lastname"
                         name="lastname{{i}}"
                         type="text"
                         placeholder="Digite aqui"
                         class="input input-bordered input-xs"></td>
              <td><input required
                         [(ngModel)]="user.email"
                         name="email{{i}}"
                         type="text"
                         placeholder="Digite aqui"
                         class="input input-bordered input-xs"></td>
              <td class="flex">
                <input
                  required
                  [(ngModel)]="user.day"
                  name="day{{i}}"
                  type="text"
                  min="1"
                  max="31"
                  placeholder="Dia"
                  class="input input-bordered input-xs"
                >

                <input
                  required
                  [(ngModel)]="user.month"
                  name="month{{i}}"
                  type="text"
                  min="1"
                  max="12"
                  placeholder="Mês"
                  class="input input-bordered input-xs"
                >

                <input
                  required
                  [(ngModel)]="user.year"
                  name="year{{i}}"
                  type="text"
                  placeholder="Ano"
                  class="input input-bordered input-xs"
                >
              </td>

              <td>
                <div class="dropdown dropdown-end flex-2">
                  <div tabindex="0" role="button"
                       class="p-1 m-1 material-icons flex items-center select select-xs select-bordered">
                    <span class="text-sm poppins-regular pr-10">Selecionar</span>
                  </div>
                  <table tabindex="0"
                         class="table table-xs dropdown-content menu bg-base-100 rounded-box z-[50] w-52 shadow overflow-auto">
                    <tr *ngFor="let role of roles">
                      <td>
                        <input type="checkbox"
                               class="checkbox"
                               (change)="changeRole(user.userId, role.nomeRole)"
                               [checked]="verifyRole(user.userId, role.nomeRole)"/>
                      </td>
                      <td class="poppintypeNames-light select-none lower-text">{{ role.nomeRole }}</td>
                    </tr>
                  </table>
                </div>

                <!--                <input required-->
                <!--                         [(ngModel)]="user.role"-->
                <!--                         name="role{{i}}"-->
                <!--                         type="text"-->
                <!--                         placeholder="Digite aqui"-->
                <!--                         class="input input-bordered input-xs">-->
              </td>
              <td><input type="checkbox"
                         name="status{{i}}"
                         [(ngModel)]="user.status"
                         class="toggle toggle-primary"/>
                } @else if (add) {
              <td hidden><input disabled
                                [(ngModel)]="user.userId"
                                name="userId{{i}}"
                                type="text"
                                class="input input-bordered input-xs"
              ></td>
              <td><input required
                         [disabled]="user.userId !== ''"
                         [(ngModel)]="user.username"
                         name="username{{i}}"
                         type="text"
                         placeholder="Digite aqui"
                         class="input input-bordered input-xs"
              ></td>
              <td><input required
                         [disabled]="user.userId !== ''"
                         [(ngModel)]="user.name"
                         name="name{{i}}"
                         type="text"
                         placeholder="Digite aqui"
                         class="input input-bordered input-xs"></td>
              <td><input required
                         [(ngModel)]="user.lastname"
                         [disabled]="user.userId !== ''"
                         name="lastname{{i}}"
                         type="text"
                         placeholder="Digite aqui"
                         class="input input-bordered input-xs"></td>
              <td><input required
                         [(ngModel)]="user.email"
                         [disabled]="user.userId !== ''"
                         name="email{{i}}"
                         type="text"
                         placeholder="Digite aqui"
                         class="input input-bordered input-xs"></td>
              <td><input required
                         [(ngModel)]="user.dateOfBirth"
                         [disabled]="user.userId !== ''"
                         name="dateOfBirth{{i}}"
                         type="text"
                         placeholder="Digite aqui"
                         class="input input-bordered input-xs"></td>
              <td><input required
                         [(ngModel)]="user.role"
                         [disabled]="user.userId !== ''"
                         name="role{{i}}"
                         type="text"
                         placeholder="Digite aqui"
                         class="input input-bordered input-xs"></td>
              <td><input type="checkbox"
                         name="status{{i}}"
                         [(ngModel)]="user.status"
                         [disabled]="user.userId !== ''"
                         class="toggle toggle-primary"/></td>
            } @else {
              <td hidden disabled>{{ user.userId }}</td>
              <td>{{ user.username }}</td>
              <td>{{ user.name }}</td>
              <td>{{ user.lastname }}</td>
              <td>{{ user.email }}</td>
              <td>{{ user.dateOfBirth | date: 'dd/MM/yyyy' }}</td>
              <td>
                <div class="dropdown dropdown-hover">
                  <div tabindex="0" role="button" class="flex items-center">Visualizar Funções<span
                    class="material-icons">arrow_drop_down_icon </span></div>
                  <ul tabindex="0" class="dropdown-content menu bg-base-100 rounded-box z-[1] w-52 p-2 shadow">
                    <li *ngFor="let role of filterRolesByUserId(user.userId)">{{ role.role }}</li>
                  </ul>
                </div>
              </td>
              <td><input type="checkbox"
                         (click)="false"
                         name="status{{i}}"
                         [(ngModel)]="user.status"
                         class="toggle toggle-primary"/></td>
              <td>
                <app-button title="Resetar Senha"
                            class="btn-sm"
                            [action]="resetPassword(user.userId)">
                </app-button>
              </td>
            }
          </tr>
        </app-table>
      </form>
    </div>

  </div>

</div>
