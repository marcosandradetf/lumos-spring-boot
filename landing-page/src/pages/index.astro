---
import { getCollection, type CollectionEntry } from 'astro:content';
import MarketingLayout from '@/layouts/MarketingLayout.astro';
import Hero from '@sections/marketing/Hero.astro';
import LogoCloud from '@sections/marketing/LogoCloud.astro';
import HowItWorks from '@sections/marketing/HowItWorks.astro';
import FeaturesSection from '@sections/marketing/FeaturesSection.astro';
import BentoGrid from '@sections/marketing/BentoGrid.astro';
import PricingTable from '@sections/pricing/PricingTable.astro';
import TestimonialsSection from '@sections/social-proof/TestimonialsSection.astro';
import CTA from '@sections/marketing/CTA.astro';
import Newsletter from '@sections/marketing/Newsletter.astro';
import { siteConfig } from '@/config';
import IntegrationsGrid from '@sections/marketing/IntegrationsGrid.astro';

type TestimonialEntry = CollectionEntry<'testimonials'>;

const testimonials = await getCollection(
  'testimonials',
  ({ data }: { data: TestimonialEntry['data'] }) => !data.draft
);
const sortedTestimonials = [...testimonials].sort(
  (a: TestimonialEntry, b: TestimonialEntry) => a.data.order - b.data.order
);

const integrations = [
  {
    name: 'GitLab',
    logo: '/images/integrations/gitlab.svg',
    category: 'Development',
    featured: true,
    description: 'Full CI/CD integration with GitLab repositories.',
    href: '/integrations',
  },
  {
    name: 'Slack',
    logo: '/images/integrations/slack.svg',
    category: 'Communication',
    featured: true,
    description: 'Get deployment notifications and alerts in your Slack channels.',
    href: '/integrations',
  },
  {
    name: 'n8n',
    logo: '/images/integrations/n8n.svg',
    category: 'Automation',
    featured: true,
    description: 'Workflow automation with n8n integrations.',
    href: '/integrations',
  },
];

const featuredIntegrations = integrations.filter((i) => i.featured);

const bentoItems = [
  {
    title: 'Preview Deployments',
    description:
      'Every PR gets its own preview URL. Share with your team and get feedback before merging.',
    icon: 'lucide:eye',
    size: 'large' as const,
    accent: 'primary' as const,
    href: '/docs/previews',
  },
  {
    title: 'Instant Rollbacks',
    description: 'One-click rollback to any previous deployment.',
    icon: 'lucide:history',
    accent: 'blue' as const,
    href: '/docs/rollback',
  },
  {
    title: 'Edge Caching',
    description: 'Smart caching at 200+ edge locations worldwide.',
    icon: 'lucide:database',
    accent: 'green' as const,
    href: '/docs/edge-network',
  },
  {
    title: 'Team Collaboration',
    description:
      'Role-based access, deployment comments, and audit logs for your entire organization.',
    icon: 'lucide:users',
    size: 'medium' as const,
    accent: 'purple' as const,
    href: '/docs/teams',
  },
];

const features = [
  {
    icon: 'lucide:zap',
    title: 'Lightning Fast Deploys',
    description:
      'Push to deploy in seconds, not minutes. Our optimized build pipeline gets your changes live faster than ever.',
  },
  {
    icon: 'lucide:refresh-cw',
    title: 'Automatic Rollbacks',
    description:
      'Something went wrong? Instantly roll back to any previous deployment with a single click.',
  },
  {
    icon: 'lucide:globe',
    title: 'Global Edge Network',
    description:
      'Your app runs on 200+ edge locations worldwide, ensuring blazing fast load times for every user.',
  },
  {
    icon: 'lucide:shield',
    title: 'Built-in Security',
    description:
      'SSL certificates, DDoS protection, and security headers configured automatically for every project.',
  },
  {
    icon: 'lucide:bar-chart',
    title: 'Real-time Analytics',
    description:
      'Monitor performance, track errors, and understand your users with built-in observability tools.',
  },
  {
    icon: 'lucide:handshake',
    title: 'Team Collaboration',
    description:
      'Preview deployments for every PR, role-based access control, and seamless Git integration.',
  },
];

const pricingPlans = [
  {
    name: 'Essencial',
    monthlyPrice: 167,
    description: 'Até 5 usuários',
    features: [
      'Gestão completa de contratos e saldos',
      'Estoque por almoxarifado e veículo',
      'Ordens de serviço',
      'Aplicativo de campo',
      'Gestão avançada de equipes',
      'Relatórios operacionais',
    ],
    highlighted: false,
    cta: {
      label: 'Iniciar teste grátis',
      href: '/contact',
    },
  },
  {
    name: 'Profissional',
    monthlyPrice: 329,
    description: 'Até 10 usuários',
    features: [
      'Todos os recursos do plano Essencial',
      'Coleta de coordenadas geográficas',
      'Relatórios fotográficos',
      'Assinatura digital em campo',
      'Coleta de coordenadas geográficas',
    ],
    highlighted: true,
    cta: {
      label: 'Iniciar teste grátis',
      href: '/contact',
    },
  },
  {
    name: 'Enterprise',
    monthlyPrice: 410,
    description: 'Até 10 usuários',
    features: [
      'Todos os recursos do plano Profissional',
      'Dashboard gerencial',
      'Suporte dedicado',
      'Customizações sob demanda',
      'Uso offline no aplicativo',
    ],
    highlighted: false,
    cta: {
      label: 'Iniciar Teste Grátis',
      href: '/contact',
    },
  },
];
---

<MarketingLayout
  title={`${siteConfig.name} - ${siteConfig.description}`}
  description={siteConfig.description}
>
  <Hero
    title="Lumos, Gestão de Iluminação Pública"
    subtitle="O Lumos otimiza todo o seu fluxo de trabalho, do Cadastro de Novos Contratos à Visualização de Relatórios. Gerencie o fluxo operacional e administrativo em um único lugar. Sem necessidade de uso de planilhas."
    primaryCTA={{ label: 'Testar Grátis', href: '/pricing' }}
    secondaryCTA={{ label: 'Acessar Demonstração', href: '/pricing' }}
  />

  <LogoCloud
    title="Nossos por parceiros:"
    logos={[
      { name: 'Solutions Engenharia', src: '/images/logos/logo_solutions.svg' },
      { name: 'Logo Ipsum 2', src: '/images/logos/logoipsum-2.svg' },
      { name: 'Logo Ipsum 3', src: '/images/logos/logoipsum-3.svg' },
      { name: 'Logo Ipsum 4', src: '/images/logos/logoipsum-4.svg' },
      { name: 'Logo Ipsum 5', src: '/images/logos/logoipsum-5.svg' },
      { name: 'Logo Ipsum 6', src: '/images/logos/logoipsum-6.svg' },
    ]}
    grayscale={false}
    logoSize="lg"
  />

  <HowItWorks
    title="Implantação em três etapas"
    subtitle="Seu fluxo operacional pronto em MINUTOS."
    steps={[
      {
        title: 'Configurar informações',
        description:
          "Criar o usuário administrador, insira os dados da empresa e decida se quer reaproveitar o nosso catálogo de itens contratuais e/ou materiais.",
        icon: 'lucide:settings',
      },
      {
        title: 'Configurar ambiente',
        description:
          'Crie os usuários que irão acessar o sistema, as equipes operacionais, os almoxarifados e caminhões.',
        icon: 'lucide:person-standing',
      },
      {
        title: 'Iniciar o uso',
        description: 'Faça as movimentações de estoque e crie ordens de serviço a partir dos contratos criados.',
        icon: 'lucide:rocket',
      },
    ]}
    variant="horizontal"
    background="muted"
  />

  <!--<IntegrationsGrid-->
  <!--  title="Integrations"-->
  <!--  subtitle="Our platform integrates seamlessly with the tools you already use."-->
  <!--  integrations={featuredIntegrations}-->
  <!--  variant="detailed"-->
  <!--  invertOnDark={false}-->
  <!--  columns={3}-->
  <!--  background="default"-->
  <!--  footerLink={{ label: 'View all integrations →', href: '/integrations' }}-->
  <!--/>-->

  <FeaturesSection
    title="Everything you need to ship"
    subtitle="From development to production, Virex provides all the tools your team needs to move fast and stay reliable."
    features={features}
    background="muted"
    footerLink={{ label: 'View all feature →', href: '/features' }}
  />

  <BentoGrid
    title="Developer-First Features"
    subtitle="Built by developers, for developers. Every feature designed to make your workflow smoother."
    items={bentoItems}
    background="muted"
  />

  <PricingTable
    title="Preços simples e transparentes"
    subtitle="Faça um teste grátis e decida se quer continuar. Sem taxas ocultas."
    plans={pricingPlans}
    annualDiscount={20}
    background="default"
    footerLink={{ label: 'Ver os planos detalhados →', href: '/pricing' }}
  />

  {
    siteConfig.features.testimonials && sortedTestimonials.length > 0 && (
      <TestimonialsSection
        title="Loved by developers"
        subtitle="Join thousands of teams who trust Virex to power their deployments."
        background="muted"
        limit={4}
        footerLink={{ label: 'View all testimonial →', href: '/testimonials' }}
        testimonials={sortedTestimonials.map((t) => ({
          quote: t.data.quote,
          author: t.data.author,
          role: t.data.role,
          company: t.data.company,
          avatar: t.data.avatar,
        }))}
      />
    )
  }

  <CTA
    title="Pronto para melhorar sua operação?"
    description="Comece a usar o Lumos hoje mesmo. Oferecemos um período de 14 dias para testar."
    action={{ label: 'Conhecer os Planos', href: '/pricing' }}
  />

  <!--<Newsletter />-->
</MarketingLayout>
